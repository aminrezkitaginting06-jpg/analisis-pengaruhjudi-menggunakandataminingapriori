import os
import csv
from itertools import combinations
from typing import List, Tuple, Dict

from telegram import Update
from telegram.ext import (
    Application, CommandHandler, MessageHandler, ConversationHandler,
    filters, ContextTypes
)

# =========================
# KONFIG
# =========================
BOT_TOKEN = os.getenv("BOT_TOKEN") or "8038423070:AAGMen0EKwhi1Up3rkWKGghg-Jf_cxgM1DI"
MIN_SUPPORT = 0.30

GROUPS = [
    ("TOTAL",),
    ("JK1", "JK2"),
    ("UMR1", "UMR2", "UMR3", "UMR4", "UMR5"),
    ("PT1", "PT2", "PT3", "PT4"),
    ("FBJ1", "FBJ2", "FBJ3", "FBJ4"),
    ("JJ1", "JJ2", "JJ3", "JJ4"),
    ("PDB1", "PDB2", "PDB3", "PDB4"),
    ("MK1", "MK2"),
    ("FB1", "FB2", "FB3", "FB4"),
    ("KJO1", "KJO2"),
    ("PJO1", "PJO2"),
    ("ABJ1", "ABJ2", "ABJ3", "ABJ4", "ABJ5"),
]

ITEM_LABELS = {
    "JK1": "ğŸ‘© JK1", "JK2": "ğŸ‘¨ JK2",
    "UMR1": "ğŸ‚ UMR1", "UMR2": "ğŸ§‘â€ğŸ’¼ UMR2", "UMR3": "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ UMR3",
    "UMR4": "ğŸ‘´ UMR4", "UMR5": "ğŸ‘µ UMR5",
    "PT1": "ğŸ“š PT1", "PT2": "ğŸ« PT2", "PT3": "ğŸ“ PT3", "PT4": "ğŸ“ğŸ“ PT4",
    "FBJ1": "ğŸ“…ğŸ”¥ FBJ1", "FBJ2": "ğŸ“… FBJ2", "FBJ3": "ğŸ“† FBJ3", "FBJ4": "â³ FBJ4",
    "JJ1": "ğŸ² JJ1", "JJ2": "âš½ JJ2", "JJ3": "ğŸƒ JJ3", "JJ4": "â“ JJ4",
    "PDB1": "ğŸ’¸ PDB1", "PDB2": "ğŸ’° PDB2", "PDB3": "ğŸ’µ PDB3", "PDB4": "ğŸ¦ PDB4",
    "MK1": "â— MK1", "MK2": "âœ”ï¸ MK2",
    "FB1": "ğŸ™…â€â™‚ï¸ FB1", "FB2": "ğŸ¤ FB2", "FB3": "ğŸ”¥ FB3", "FB4": "ğŸ’¥ FB4",
    "KJO1": "ğŸ°â— KJO1", "KJO2": "âœ”ï¸ KJO2",
    "PJO1": "ğŸ’” PJO1", "PJO2": "ğŸ’– PJO2",
    "ABJ1": "ğŸ° ABJ1", "ABJ2": "â— ABJ2", "ABJ3": "ğŸ—£ï¸ ABJ3", "ABJ4": "âš ï¸ ABJ4", "ABJ5": "ğŸ¤¥ ABJ5",
}

FIELD_PROMPTS = {
    "TOTAL": "ğŸ“Š Masukkan TOTAL keseluruhan data yang dianalisis (angka):",
    "JK1": "ğŸ‘© Masukkan Jumlah Perempuan (JK1):",
    "JK2": "ğŸ‘¨ Masukkan Jumlah Laki-Laki (JK2):",
    "UMR1": "ğŸ‚ Masukkan Jumlah usia < 20 Tahun (UMR1):",
    "UMR2": "ğŸ§‘â€ğŸ’¼ Masukkan Jumlah usia 20-30 Tahun (UMR2):",
    "UMR3": "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Masukkan Jumlah usia 31-40 Tahun (UMR3):",
    "UMR4": "ğŸ‘´ Masukkan Jumlah usia 41-50 Tahun (UMR4):",
    "UMR5": "ğŸ‘µ Masukkan Jumlah usia > 50 Tahun (UMR5):",
    "PT1": "ğŸ“š Masukkan Tamatan SD/Sederajat (PT1):",
    "PT2": "ğŸ« Masukkan Tamatan SMP/Sederajat (PT2):"
